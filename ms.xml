<?xml version="1.0" encoding="UTF-8"?>
<exp:Export Version="3.0"
    xmlns:L7p="http://www.layer7tech.com/ws/policy"
    xmlns:exp="http://www.layer7tech.com/ws/policy/export" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <exp:References/>
    <wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
        <wsp:All wsp:Usage="Required">
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="############################################################################################"/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="############################################################################################"/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="##  "/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="## Eureka http://192.168.201.152:8761/eureka/apps"/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="##  Policy http://192.168.201.152:8080/test"/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="##  v1.0 Darrin Solomon"/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="##  "/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="############################################################################################"/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="############################################################################################"/>
            </L7p:CommentAssertion>
            <L7p:AuditAssertion/>
            <L7p:HttpRoutingAssertion>
                <L7p:ProtectedServiceUrl stringValue="http://192.168.201.152:8761/eureka/apps"/>
                <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                    <L7p:ForwardAll booleanValue="true"/>
                    <L7p:Rules httpPassthroughRules="included">
                        <L7p:item httpPassthroughRule="included">
                            <L7p:Name stringValue="Cookie"/>
                        </L7p:item>
                        <L7p:item httpPassthroughRule="included">
                            <L7p:Name stringValue="SOAPAction"/>
                        </L7p:item>
                    </L7p:Rules>
                </L7p:RequestHeaderRules>
                <L7p:RequestParamRules httpPassthroughRuleSet="included">
                    <L7p:ForwardAll booleanValue="true"/>
                    <L7p:Rules httpPassthroughRules="included"/>
                </L7p:RequestParamRules>
                <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                    <L7p:ForwardAll booleanValue="true"/>
                    <L7p:Rules httpPassthroughRules="included">
                        <L7p:item httpPassthroughRule="included">
                            <L7p:Name stringValue="Set-Cookie"/>
                        </L7p:item>
                    </L7p:Rules>
                </L7p:ResponseHeaderRules>
                <L7p:SamlAssertionVersion intValue="2"/>
            </L7p:HttpRoutingAssertion>
            <L7p:ResponseXpathAssertion>
                <L7p:VariablePrefix stringValue="ipAddr"/>
                <L7p:XpathExpression xpathExpressionValue="included">
                    <L7p:Expression stringValue="/applications/application/instance[app='HELLO' and status='UP']/ipAddr"/>
                    <L7p:Namespaces mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="s"/>
                            <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                        </L7p:entry>
                    </L7p:Namespaces>
                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                </L7p:XpathExpression>
            </L7p:ResponseXpathAssertion>
            <L7p:SetVariable>
                <L7p:Base64Expression stringValue="JHtpcEFkZHIucmVzdWx0c30="/>
                <L7p:VariableToSet stringValue="ipAddr.results"/>
            </L7p:SetVariable>
            <L7p:SetVariable>
                <L7p:Base64Expression stringValue="JHtpcEFkZHIucmVzdWx0c30="/>
                <L7p:VariableToSet stringValue="ipAddr.static"/>
            </L7p:SetVariable>
            <L7p:SetVariable>
                <L7p:Base64Expression stringValue="JHtpcEFkZHIuY291bnR9"/>
                <L7p:VariableToSet stringValue="ipAddr.static.count"/>
            </L7p:SetVariable>
            <L7p:Split>
                <L7p:InputVariable stringValue="ipAddr.results"/>
                <L7p:OutputVariable stringValue="ipAddr"/>
                <L7p:SplitPattern stringValue=", "/>
            </L7p:Split>
            <L7p:AuditDetailAssertion>
                <L7p:Detail stringValueReference="inline"><![CDATA[results: ${ipAddr.results}
ipAddr: ${ipAddr[0]} & ${ipAddr[1]}]]></L7p:Detail>
            </L7p:AuditDetailAssertion>
            <L7p:CreateRoutingStrategy>
                <L7p:Routes routes="included">
                    <L7p:item route="included">
                        <L7p:Name stringValue="${ipAddr[0]}"/>
                    </L7p:item>
                    <L7p:item route="included">
                        <L7p:Name stringValue="${ipAddr[1]}"/>
                    </L7p:item>
                    <L7p:item route="included">
                        <L7p:Name stringValue="${ipAddr[2]}"/>
                    </L7p:item>
                    <L7p:item route="included">
                        <L7p:Name stringValue="${ipAddr[3]}"/>
                    </L7p:item>
                </L7p:Routes>
                <L7p:StrategyDescription stringValue="Round-Robin"/>
                <L7p:StrategyName stringValue="robin"/>
            </L7p:CreateRoutingStrategy>
            <L7p:ForEachLoop L7p:Usage="Required"
                loopVariable="strategy.routeList" variablePrefix="routeList">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="MA=="/>
                    <L7p:DataType variableDataType="int"/>
                    <L7p:VariableToSet stringValue="feedback.current.status"/>
                </L7p:SetVariable>
                <L7p:ExecuteRoutingStrategy/>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:HttpRoutingAssertion>
                            <L7p:ConnectionTimeout stringValue="3000"/>
                            <L7p:HttpMethod httpMethod="GET"/>
                            <L7p:MaxRetries intValue="100"/>
                            <L7p:ProtectedServiceUrl stringValue="http://${route}:8080/hosts/hello"/>
                            <L7p:ProxyPassword stringValueNull="null"/>
                            <L7p:ProxyUsername stringValueNull="null"/>
                            <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                <L7p:ForwardAll booleanValue="true"/>
                                <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                </L7p:Rules>
                            </L7p:RequestHeaderRules>
                            <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                <L7p:ForwardAll booleanValue="true"/>
                                <L7p:Rules httpPassthroughRules="included"/>
                            </L7p:RequestParamRules>
                            <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                <L7p:ForwardAll booleanValue="true"/>
                                <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                </L7p:Rules>
                            </L7p:ResponseHeaderRules>
                            <L7p:SamlAssertionVersion intValue="2"/>
                        </L7p:HttpRoutingAssertion>
                        <L7p:AuditDetailAssertion>
                            <L7p:Detail stringValue="route: ${route}"/>
                        </L7p:AuditDetailAssertion>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="PGZvbnQgc2l6ZT0iNSI+bWljcm9zZXJ2aWNlcyByb3V0ZSBzZWxlY3RlZDwvZm9udD48QlI+CmNob3NlbiByb3V0ZSA6ICR7cm91dGV9PEJSPgo8QlI+PEJSPgoKPGZvbnQgc2l6ZT0iNSI+bWljcm9zZXJ2aWNlcyByZWdpc3RyeSBpbmZvcm1hdGlvbjwvZm9udD48QlI+Cm51bWJlciBhdmFpbGFibGUgcm91dGVzIDogJHtpcEFkZHIuc3RhdGljLmNvdW50fSA8QlI+CmFjdGl2ZSByb3V0ZXMgOiAke2lwQWRkci5zdGF0aWN9IDxCUj4KPEJSPjxCUj4KCjxmb250IHNpemU9IjUiPm1pY3Jvc2VydmljZXMgcm91dGluZyBpbmZvcm1hdGlvbjwvZm9udD48QlI+CmxhdGVuY3kgICAgICAgICAgICAgICAgICAgOiAke2Fzc2VydGlvbi5sYXRlbmN5Lm1zfSA8QlI+Cmh0dHAgcmVhc29uICAgICAgICAgICAgICAgOiAke2h0dHByb3V0aW5nLnJlYXNvbkNvZGV9IDxCUj4KPEJSPjxCUj4KCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gPEJSPjxCUj4KPGZvbnQgc2l6ZT0iNSI+ZW5kcG9pbnQgcmVzcG9uc2U8L2ZvbnQ+PEJSPgoke3Jlc3BvbnNlLm1haW5wYXJ0fQ=="/>
                            <L7p:ResponseContentType stringValue="text/html; charset=UTF-8"/>
                        </L7p:HardcodedResponse>
                    </wsp:All>
                    <L7p:HttpRoutingAssertion>
                        <L7p:Enabled booleanValue="false"/>
                        <L7p:ProtectedServiceUrl stringValue="http://172.17.0.7:8080"/>
                        <L7p:ProxyPassword stringValueNull="null"/>
                        <L7p:ProxyUsername stringValueNull="null"/>
                        <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                            <L7p:ForwardAll booleanValue="true"/>
                            <L7p:Rules httpPassthroughRules="included">
                                <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                </L7p:item>
                                <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                </L7p:item>
                            </L7p:Rules>
                        </L7p:RequestHeaderRules>
                        <L7p:RequestParamRules httpPassthroughRuleSet="included">
                            <L7p:ForwardAll booleanValue="true"/>
                            <L7p:Rules httpPassthroughRules="included"/>
                        </L7p:RequestParamRules>
                        <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                            <L7p:ForwardAll booleanValue="true"/>
                            <L7p:Rules httpPassthroughRules="included">
                                <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                </L7p:item>
                            </L7p:Rules>
                        </L7p:ResponseHeaderRules>
                        <L7p:SamlAssertionVersion intValue="2"/>
                    </L7p:HttpRoutingAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="LTE="/>
                        <L7p:DataType variableDataType="int"/>
                        <L7p:VariableToSet stringValue="feedback.current.status"/>
                    </L7p:SetVariable>
                    <L7p:HardcodedResponse>
                        <L7p:Base64ResponseBody stringValue="ZGFycmlu"/>
                        <L7p:Enabled booleanValue="false"/>
                        <L7p:ResponseContentType stringValue="text/plain; charset=UTF-8"/>
                    </L7p:HardcodedResponse>
                </wsp:OneOrMore>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHthc3NlcnRpb24ubGF0ZW5jeS5tc30="/>
                    <L7p:VariableToSet stringValue="feedback.current.latency"/>
                </L7p:SetVariable>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtodHRwcm91dGluZy5yZWFzb25Db2RlfQ=="/>
                    <L7p:VariableToSet stringValue="feedback.current.reasonCode"/>
                </L7p:SetVariable>
                <wsp:OneOrMore wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${feedback.current.status}"/>
                        <L7p:Operator operatorNull="null"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:Negated booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                            <L7p:item binary="included">
                                <L7p:RightValue stringValue="-1"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                        <L7p:VariableToSet stringValue="routeList.break"/>
                    </L7p:SetVariable>
                </wsp:OneOrMore>
            </L7p:ForEachLoop>
            <L7p:ProcessRoutingStrategyResult/>
        </wsp:All>
    </wsp:Policy>
</exp:Export>
